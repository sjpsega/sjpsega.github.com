
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>sjpsega's Blog</title>
  <meta name="author" content="sjpsega">

  
  <meta name="description" content="最近的股市，真是可以用操蛋来形容：做多的 A 股港股，震荡下行；做空的美股迭创新高。因为做空加了杠杆，最近账户多次变为「较高风险」等级，因为怕再次变为「预警」等级，需要平仓，故多次买入降杠杆。 看着账户资金逐渐变少，这种感觉，真心难受！我也惊呆了，做空的 拼多多、好未来、AMD，一个比一个牛， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!--友言验证-->
  <meta name="uyan_auth" content="7d2af41cee" />

  
  <link rel="canonical" href="http://sjpsega.me/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="sjpsega's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/jquery.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts 
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->
  

  <script type="text/javascript">
  //链接新开窗口
  function addBlankTargetForLinks () {
      $('a[href^="http"]').each(function(){
          $(this).attr('target', '_blank');
      });
  }
  $(document).ready(function(event) {
      addBlankTargetForLinks();
  });
  </script>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">sjpsega's Blog</a></h1>
  
    <h2>记录我的生活与学习.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="sjpsega.me">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">所有文章</a></li>
  <li><a href="/blog/categories/study">学习</a></li>
  <li><a href="/blog/categories/life">生活</a></li>
  <li><a href="http://weibo.com/sjpsega" target="_blank">我的微博</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/11/23/crazyusstock/">疯狂的美股</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-11-23T00:15:32+08:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>23</span><span class='date-suffix'>rd</span>, <span class='date-year'>2019</span></span> <span class='time'>12:15 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/2019-11-23-crazyusstock/20191122_china_stock.jpg" alt="20191122_china_stock" /></p>

<p><img src="/images/2019-11-23-crazyusstock/20191122_hk_stock.jpg" alt="20191122_hk_stock" /></p>

<p><img src="/images/2019-11-23-crazyusstock/20191122_us_stock.jpg" alt="20191122_us_stock" /></p>

<p>最近的股市，真是可以用操蛋来形容：做多的 A 股港股，震荡下行；做空的美股迭创新高。因为做空加了杠杆，最近账户多次变为「较高风险」等级，因为怕再次变为「预警」等级，需要平仓，故多次买入降杠杆。</p>

<p>看着账户资金逐渐变少，这种感觉，真心难受！我也惊呆了，做空的 拼多多、好未来、AMD，一个比一个牛，迭创新高，心想，如果我是做多的，该多好……</p>

<p>按理说，美股牛了 10 年，最近又连续降息，来保经济，也预示着美股快到头了，但是，长时间的做空，来博美股崩溃的时机，真心难受。心累，钱也难受，因为做空本来就需要付出不少利息。</p>

<p>还是经验不足，更重要的是，长期需要做多，做空要看形式，也只能是短时间，否则是完全把自己暴露在风险当中。</p>

<p>还好上天眷顾，20 号拼多多出财报，不及预期，暴跌 22.89%，将拼多多的仓位平仓，仓位水位大幅下降，且拼多多做空仓位盈利了。</p>

<p><img src="/images/2019-11-23-crazyusstock/20191120_pdd.PNG" alt="20191120_pdd" /></p>

<p>猥琐发育。愿上天再度眷恋我，可能就在明年。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/09/15/910/">怒放的生命</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-09-15T23:42:21+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2019</span></span> <span class='time'>11:42 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/2019-09-15-910/mayun_pengke.jpeg" alt="mayun_pengke" /></p>

<p>2019-09-10，教师节，也是阿里巴巴 20 周年纪念日；同时，还是阿里的灵魂人物 马云 的生日。</p>

<p>那天，阿里包下杭州奥体，举行了盛大的周年庆祝会。</p>

<p>整场晚会非常精彩，但令我印象最深刻的是，马云 再次朋克风，领衔演唱了《怒放的生命》。</p>

<p>仔细品味歌词，着实演绎了 马爸爸 创立阿里 20 年的真实写照，由 马爸爸 亲口演唱，实在是再合适不过了！</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>曾经多少次跌倒在路上
</span><span class='line'>曾经多少次折断过翅膀
</span><span class='line'>如今我已不再感到彷徨
</span><span class='line'>我想超越这平凡的奢望
</span><span class='line'>我想要怒放的生命
</span><span class='line'>就像飞翔在辽阔天空
</span><span class='line'>就像穿行在无边的旷野
</span><span class='line'>拥有挣脱一切的力量
</span><span class='line'>曾经多少次失去了方向
</span><span class='line'>曾经多少次破灭了梦想
</span><span class='line'>如今我已不再感到迷茫
</span><span class='line'>我要我的生命得到解放
</span><span class='line'>我想要怒放的生命
</span><span class='line'>就像飞翔在辽阔天空
</span><span class='line'>就像穿行在无边的旷野
</span><span class='line'>拥有挣脱一切的力量
</span><span class='line'>我想要怒放的生命
</span><span class='line'>就像矗立在彩虹之巅
</span><span class='line'>就像穿行在璀璨的星河
</span><span class='line'>拥有超越平凡的力量</span></code></pre></td></tr></table></div></figure>




<iframe height='498' width='100%' src='http://player.youku.com/embed/XNDM1Nzg1Mzk2NA==' frameborder=0 'allowfullscreen'></iframe>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/07/22/kechuangban/">科创板</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-07-22T23:41:55+08:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2019</span></span> <span class='time'>11:41 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天，又是一个 A 股历史上的大日子 - 大大钦点的「科创板」正式上线。</p>

<p>据说 7.22 上线，是因为 05、14 年的大牛市的起点，是以 7.22 为支点。</p>

<p>今天科创板的走势 - 先抑后扬，据说和当年的科创板上线第一天的走势非常像：开盘高开，一波下杀，换手充分；临近中午，达到全天高点，然后平稳下跌。其实，昨天 骑大 的文章《科创首日上市，牢记7个数字》，已经把一天的情况，都数字化分析过了，奈何，缺乏实际体验，今早也没再次细读，导致今天对中科创板新股 - 天宜上佳（688033）的操作稀烂：早上下杀卖了一笔，下午平稳下跌，再卖一笔。卖点太差了……</p>

<p><img src="/images/2019-07-22-kechuangban/688033-situation.png" alt="688033-situation" /></p>

<p>今天，科创板首发 25 支新股，首日平均涨幅 140%，我才赚了 60%，哭死……</p>

<p>按照科创板的规则，新股上市前 5 日，无涨幅限制，但第 1 天换手已经达到 80%，后面几天预计行情会更加精彩，拭目以待。</p>

<p><img src="/images/2019-07-22-kechuangban/kechuangban-zhangfu.jpg" alt="kechuangban-zhangfu" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/04/04/payout/">用错误的方法赚到钱，迟早要还</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-04-04T00:17:35+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2019</span></span> <span class='time'>12:17 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="/images/2019-04-04-payout/20190404_us_stock.jpg" alt="20190404_us_stock" /></p>

<p>昨晚，美股做空，第一次收到了「平仓」预警信息。</p>

<p>去年下半年，做空美股，赚了 40%+。今年，中港美股市，都大涨，美股都快涨到前高了，太可怕了……</p>

<p>因为做空，还有杠杆，且杠杆高，现在已经把去年赚的钱，连本带利都亏进去了。</p>

<p>我觉得，我真的印证了这句话「用错误的方法赚到钱，迟早要还」。</p>

<p>也慢慢懂了，别人说的「永远不要做空美股」这句话。</p>

<p>还有，自己缺少政治敏感，我印象中，1 月初，出了美国要暂停加息的消息。其实，那个时候，就应该平仓了，不该全力空了，把自己暴露到不断扩大的风险当中。</p>

<p>去年做空，赚了钱，自大了。需要学习与复盘，就算做空，一定一定要控制仓位。可能，最终，我做空是对的，但我中途可能就爆仓了……</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/01/01/2018summary/">2018 年终总结</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-01-01T18:44:36+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2019</span></span> <span class='time'>6:44 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>18 已过，19 已来。
18 年，又是最最最困难的一年，但我运气不错，“猪”事顺利。</p>

<ul>
<li>喜

<ul>
<li>去年，老婆怀孕了，在 8 月底生了一个漂亮的女孩子，终于，儿女双全，人生圆满，辛苦老婆了。</li>
<li>虽然去年老婆怀孕，但为了儿子不太闷，也带儿子出去玩了几次：

<ul>
<li>2 月份去了上海迪士尼，第二次去，人还是那么多，儿子玩得很开心，我是不想再去了……</li>
<li>5 月去了广州长隆，让我眼前一亮的地方，景致不错，很适合带孩子一家人来旅游。长隆酒店餐厅里有真的白虎……去了长隆野生动物园、长隆海洋王国，都是孩子喜欢的地方，儿子很喜欢，说还想再去。</li>
</ul>
</li>
<li>公司旅游，6 月份去了青海，很棒的一次体验，看了下祖国的西部。西宁的羊肉，青海湖辽阔，高原 Windows 桌面般的风景，茶卡尔盐湖的天空之镜，令人印象深刻。</li>
<li>新房子装修完毕，大头的金钱支出，去年基本解决了。多余的也交给了中介，做出租，有了稳定的收入来源。</li>
<li>工作上，17 年表现突出，年末考评好，年终奖丰厚，还获得了一点股权，很不错。工作虽然忙碌，但都是自己感兴趣的，颇有成就感。</li>
<li>去年批量暴雷的 P2P，弄得人心惶惶，因为重仓，我是真的怕了。还去「懒投资」的杭州办事处去实地查看了，结果还没人员入驻，我还以为跑路了呢……还好，「懒投资」稳稳的，没出问题。</li>
<li>投资上，运气实在太好，秉承做多 A 股，做空美股的原则，虽然 A 股、港股亏损，但通过做空美股成功在总体上大幅减少了亏损。A 股的主要仓位变化和去年总结的一致，大部分仓位已经迁移到基金上，做个股太累了，而且今年买个几个个股，踩了 2 个坑，运气太好了……去年的投资总收益为 <code>-2.58%</code>，在全市场大幅下跌的情况下，已经非常不错，具体情况如下表：</li>
</ul>
</li>
</ul>


<table>
<thead>
<tr>
<th style="text-align:left;">投资标的</th>
<th style="text-align:left;">收益率</th>
<th style="text-align:left;">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">A 股 1(RMB)</td>
<td style="text-align:left;">-10.04%</td>
<td style="text-align:left;">上证 3307.17 - 2493.9，-24.591%；中证 1000，7017.35 - 4430.02，-36.870%</td>
</tr>
<tr>
<td style="text-align:left;">A 股 2(RMB)</td>
<td style="text-align:left;">-6.91%</td>
<td></td>
</tr>
<tr>
<td style="text-align:left;">港股(HKD)</td>
<td style="text-align:left;">-17.40%</td>
<td style="text-align:left;">恒生 29919.15 - 25845.7，-13.614%</td>
</tr>
<tr>
<td style="text-align:left;">美股(USD)</td>
<td style="text-align:left;">41.30%</td>
<td style="text-align:left;">道琼斯 24719.22 - 23327.46，-5.630%；纳斯达克 6903.39 - 6635.28，-3.883%；标普 500，2673.61 - 2506.85，-6.237%</td>
</tr>
</tbody>
</table>


<ul>
<li>忧

<ul>
<li>平时工作上还是不够专注，经常手机上看股票行情，效率低下，主要仓位迁移到基金上，可以少看行情。</li>
<li>生了一个妹妹，关注儿子的时间少了，但儿子还算乖，但不听话，不肯写字认字；教他英语，我真是气不打从一处来，太笨了……我自己也需要更加耐心一点吧。</li>
<li>作息还是（第三年了吧……）不规则，经常搞到一两点才睡…</li>
<li>前年是叹息少买一套房，去年是感叹没早点卖房……上半年杭州楼市还是一片红火，但一到 7 月份，差不多是美帝开始贸易战，就一蹶不振，房子不好卖了。去年给妹妹报户口，想起来儿子读书的事情，为了一表生，所以动起了卖房的念头，但是市场不好，也因为我定价稍高，都没人看房。儿子读书的事情，估计要另想办法了。</li>
<li>去年，晋升准备不充分，临场发挥不好，晋升失败了……今年加油吧！</li>
</ul>
</li>
</ul>


<h2>2018 展望</h2>

<ul>
<li>多陪陪儿子，陪儿子多学习，他和我一样，太爱玩了，学习也是一头热。今年 9 月，要上小学了，必须有一个学习的好习惯。还要解决读书一表生的问题。</li>
<li>投资上继续秉承做多 A 股，做空美股的原则，稳扎稳打。</li>
<li>工作专注，多做总结，提高上班 8 小时的效率，早点回家，多陪陪家人。</li>
<li>平时作息要规律，晚上 12 点睡觉，身体重要。（第三年提这条了……）</li>
</ul>


<p>加油！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/02/14/2017summary/">2017 年终总结</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-02-14T22:30:23+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2018</span></span> <span class='time'>10:30 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>转眼间，又到年三十，中国的新年马上就要到来，又到了总结的时候了。今天还刚好是情人节，当然，我没情人&hellip;</p>

<p>总体而言，2017 还不错，中规中矩。</p>

<ul>
<li><p>喜</p>

<ul>
<li>工作上，业务上有变化，小团队一起换了个业务，还好，老板没换。工作上表现不错，积极主动，沉淀不错，但还是要更加努力，希望年终有个好结果，也期望能获得晋升。</li>
<li>投资上，还行，没有亏损，就是赚的太少了，中偏下水平。投资收益在投资总结上计算过：基金：15.37%。A 股账户 1（自己账户）：8.64%（上证 3105.31 - 3307.17，6.558%；中证 1000 8503.66 - 7017.35，-17.354%）。A 股账户 2（丈母娘账户）：17.35%。港股：35.99%（恒生 21993 - 29919，35.993%）。美股：3.1%（道琼斯 19873 - 24719，25.081%；纳斯达克 5425.62 - 6903.39，28.241%）。A股、港股还行，美股因为去年的大亏，胆子小了，操作少，也几乎没大仓位买过股票，都是小玩玩。A 股、港股消耗大量精力，还是小赚或与指数持平，更加坚定了我慢慢转向基金投资的决心。</li>
<li>去年带儿子出去玩了几次。

<ul>
<li>4 月初去了三亚，住在亚龙湾红树林酒店，6 天时间都在酒店周围。亚龙湾景色很美，酒店游乐设施齐全，儿子很喜欢，特别是地下一层的滑滑梯，到现在儿子还常常说起，想再去。</li>
<li>5 月底去了武夷山，坐了中国最美漂流，儿子也自己一步一个脚印爬上了天游峰，表现非常不错。</li>
</ul>
</li>
<li>公司旅游，6 月初去了越南岘港，发现我连越南的海鲜都吃不起，太贵……</li>
<li>儿子吃饭习惯还不错，自己吃饭，饭量不错；在家也自己睡小床了。儿子还很淘气，脾气也倔强，经常发小孩子脾气，但毕竟是孩子，总体还算乖的。</li>
</ul>
</li>
<li><p>忧</p>

<ul>
<li>临近年底，港股投资出现大问题，某途强烈推荐 - 雅生活服务，还给了 9 倍杠杆，结果我用了某途的 9 倍杠杆做了融资打新，中签率还很高，遇到行情不好，新股开盘大跌 -23.09%，坑死了。这几天涨回来许多，期望能回本出了。作为一个教训，以后申购新股要做多功课，然后，不要高杠杆打新了，心脏受不了。</li>
<li>平时工作上不够专注，经常手机上看股票行情，效率低下。</li>
<li>儿子还是做事拖拉，大家都上桌吃饭了，喜欢顾自己玩好一会儿，才肯来吃；人也内向，不肯叫人。</li>
<li>作息还是不规则，经常搞到一两点才睡&hellip;</li>
<li>没想到去年房价暴涨，杭州几乎涨了一倍，判断错误，少买一套房啊，555。</li>
</ul>
</li>
</ul>


<h2>2018 展望</h2>

<ul>
<li>多陪陪儿子，多一点耐心，多带他去外面玩；来年估计不会带他出远门，多陪陪他；来年可能他会有个妹妹（弟弟）了。</li>
<li>家里又要装修了，准备得差不多了，期望一切顺利。</li>
<li>家里装修等要花很多钱，明年是钱的问题上艰难的一年，加油，过了之后就顺风顺水了。</li>
<li>投资上继续稳扎稳打，慢慢转向基金投资。</li>
<li>工作上继续积极主动，多沉淀，多做出成果；工作中要更加专注，不要老去看股票行情了；努力晋升。</li>
<li>平时作息要规律，晚上 12 点睡觉，身体重要。</li>
</ul>


<p>加油！加油！加油！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/01/27/2016summary/">2016 年终总结</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-01-27T15:34:17+08:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>3:34 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>转眼间，又到年三十，中国的新年马上就要到来，又到了总结的时候了。</p>

<p>总体而言，2016 喜忧参半。</p>

<ul>
<li><p>喜</p>

<ul>
<li>搞了近一年的装修终于结束了，岳父岳母住进了新房。</li>
<li>5 月份在杭州房价暴涨前夕，买了一套房，浮盈颇丰。</li>
<li>6 月上旬，上海迪士尼开张，带着儿子一行三人去玩了一次，儿子可高兴了，见到了喜爱的米老鼠。</li>
<li>6 月下旬，公司团队旅游，又去了一次泰国清迈，感觉不错。</li>
<li>9 月份，杭州 G20 放假，儿子上幼儿园前夕，去了青岛旅游了一趟。天天去海边，儿子天天都很兴奋，已经爱上了海滩。可惜青岛也有雾霾…</li>
<li>儿子 3 岁了，到了上学的年纪，9 月份开始上幼儿园了，他又认识了好多好朋友。</li>
<li>11 月份买了新出的 PS4 Pro，开通了港服会员，通关了《神秘海域 4》、《巫师 3》，《巫师 3》真的非常符合我的口味，太棒了。</li>
<li>A 股、港股投资还不错；A 股主要买了 ETF 基金，全年收益大概是 4.24%，但在沪深 300 指数(起3725.86，终3310.08)全年 -11.16% 的背景下，还算不错；港股先抑后扬，全年收益率从最低的 -20% 到年底收官的 11.01 %，这还不算美元升值收益，表现令人满意。</li>
<li>工作上，几个熟悉的小伙伴相继离职，自己的老板也更变多次；开始尝试 PM 、技术经理的角色，主导项目进行，不仅仅是 coding，这点做的还不错。</li>
<li>儿子越来越懂事了，说话越来越好玩了。因为我一次发脾气，儿子改掉了吃饭看电视的坏习惯。</li>
</ul>
</li>
<li><p>忧</p>

<ul>
<li>美股亏惨了，亏了近一年的工资，把 A 股赚的都在美股亏出去了，还是在中概股私有化上亏的。私有化不靠谱啊，我把私有化概念当成高息债券玩了，结果因为 A 股大跌，国内政策更变，2015 大量中概要私有化，到 2016 年大多撤销了。我自己也因为在私有化概念上投入过大，买了坑爹的 航美传媒，止损太迟，还一直抱有幻想，导致亏损巨大，全年收益  -35.24%…</li>
<li>儿子因为鞘膜积液和疝气，分别在 2 月和 9 月动了两次手术，目前看，情况良好，期望不要再有事了，这么小的孩子做手术真的太苦了。</li>
<li>11 月，我爸某天早上送儿子上学，居然遇到车祸，不仅残疾车撞坏了，自己还左膝盖粉碎，伤筋动骨 100 天；幸好当时车上的我妈和我儿子没事。</li>
<li>今年，家里的家电坏了好多，热水器、洗衣机、电冰箱都换了一遍。</li>
<li>儿子比较内向，不肯叫人，吃饭拖拖拉拉，急需改善。</li>
<li>作息不规律，晚上经常 1、2 点睡，体检出来也有点问题了。</li>
<li>一直用 16G 的 iPhone 不够用了，10 月底买了个二手 iPhone 6S，结果用了一个月不到，发现听筒有问题，退也退不了了。去苹果官方店修，结果发现这手机的电池换过，并且是非官方店换的，官方店不给修，真的是坑死我了。最后折价了点又卖了出去，折腾了我近两个月。郁闷死，以后买数码产品我还是买一手的算了，记得之前买了个二手 PS3，结果硬盘坏了，换了硬盘，看来二手和我没什么缘分啊。</li>
</ul>
</li>
</ul>


<h2>2017 展望</h2>

<ul>
<li>引导儿子养好吃饭的好习惯；多带他去外面玩，要多叫人，外面活泼一点；4 周岁了，让他自己睡小床了。</li>
<li>投资上稳扎稳打，多学习，不要再重蹈美股巨亏的覆辙了。</li>
<li>工作上再积极主动一点，多沉淀，多做出一点成果。</li>
<li>预计带儿子出去旅游一次，去有海的地方。</li>
<li>平时作息要规律，晚上 12 点前好睡了，身体重要。</li>
</ul>


<p>加油吧！</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/09/17/paging/">iOS 仿淘宝详情页分页组件</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-09-17T21:42:08+08:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>9:42 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>本例 <a href="https://github.com/sjpsega/Paging">Demo</a>。</p>

<p>淘宝详情页的分页交互效果是一个经典的实现，隔离了淘宝商品基本属性页和图文详情页，即给用户一个良好的使用体验，也通过分页懒加载图文信息，提高了页面首屏加载速度，也减少了不必要的流量损耗。</p>

<p>下面说说怎么实现这个效果。</p>

<h2>效果预览</h2>

<p><img src="/images/2016-09-17-paging/paging-demo.gif" alt="main-flow" /></p>

<h2>实现</h2>

<p>先想一下实现分页的步骤，其实很简单，就两步:</p>

<ol>
<li>将需要分页的页面添加到分页组件上</li>
<li>页面滚动，当检测到达页面边缘，通过动画滚动到下一页或上一页</li>
</ol>


<h3>利用自带的 ScrollView</h3>

<p>想到滚动和分页，第一时间想到的肯定是自带的 UIScrollView。
因为 UIScrollView 不仅有滚动效果，并且本身已经自带了一些分页的 API，比如 <code>pagingEnabled</code> 等。</p>

<p>但是，想一下，直接使用 <code>pagingEnabled</code> 这个属性，然后添加上需要分页的页面，能实现我们的分页效果么？
答案显然是不能的，因为我们的详情页面的基本属性页和图文详情页本身就是大页面，自身就有滚动效果，如果直接使用 UIScrollView ，两个滚动效果叠加，肯定会出现问题的。</p>

<p>经过实践，我的做法是，使用 <code>UIScrollView</code> 来当做分页的容器，是利用相关的滚动 API，来实现翻页的效果。</p>

<h3>实现中遇到的问题</h3>

<p>主要是两个问题：</p>

<ol>
<li>需要分页的子页面，如何判断滚动到最底部</li>
<li>翻页的效果如何实现</li>
</ol>


<p>问题 1 很好解决，仔细研究下 UIScrollView 的属性就有答案了，就是一个数学问题。</p>

<p>图例：</p>

<p><img src="/images/2016-09-17-paging/UIScrollView-structure.jpg" alt="UIScrollView-structure" /></p>

<p>代码：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objectivec'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">contentOffsetBottom:</span><span class="p">(</span><span class="bp">UIScrollView</span><span class="o">*</span><span class="p">)</span><span class="nv">scrollView</span><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">scrollView</span><span class="p">.</span><span class="n">contentOffset</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="n">scrollView</span><span class="p">.</span><span class="n">contentSize</span><span class="p">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">scrollView</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">scrollView</span><span class="p">.</span><span class="n">contentInset</span><span class="p">.</span><span class="n">bottom</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>问题 2 也很简单，就是利用了 UIScrollView 自带的一个 API <code>- (void)scrollRectToVisible:(CGRect)rect animated:(BOOL)animated;</code> 便可。</p>

<h2>继续优化</h2>

<p>现在我们的代码实现了分页的效果，但是缺少淘宝详情页的那样分页提示文字，要实现这个也不难。</p>

<ul>
<li>需要翻到下一页，可以在该页的最后加上“继续拖动，查看图文详情”的提示 label。</li>
<li>需要返回到上一页，因为页面是 UIScrollView，可以使用 <a href="https://github.com/CoderMJLee/MJRefresh">MJRefresh</a> 加上一个自定义的 header 加上提示文字便可。</li>
</ul>


<h2>参考资料</h2>

<p><a href="http://tech.glowing.com/cn/practice-in-uiscrollview/">UIScrollView 实践经验</a></p>

<p><a href="https://developer.apple.com/library/content/documentation/WindowsViews/Conceptual/UIScrollView_pg/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008179-CH1-SW1">About Scroll View Programming</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/04/18/jspatch-study/">JSPatch 学习</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-04-18T00:19:13+08:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>18</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>12:19 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>主体流程</h2>

<p><img src="/images/2016-04-18-jspatch-study/main-flow.jpg" alt="main-flow" /></p>

<h2>JS 调用 OC 代码</h2>

<p><img src="/images/2016-04-18-jspatch-study/js2oc.jpg" alt="js2oc" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2016/02/15/cordova-wkwebview-study-2/">Cordova WKWebView 学习笔记（二）</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-02-15T00:11:47+08:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>15</span><span class='date-suffix'>th</span>, <span class='date-year'>2016</span></span> <span class='time'>12:11 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>这篇主要是代码学习。</p>

<p>官方代码地址：<a href="https://github.com/apache/cordova-plugin-wkwebview-engine">cordova-plugin-wkwebview-engine</a></p>

<p>我的测试代码：<a href="https://github.com/sjpsega/CordovaWKWebViewTest">CordovaWKWebViewTest</a>，融合了一个 Device JSBridge 的例子，该例子参考自<a href="https://crosswalk-project.org/documentation/ios/cordova_plugin_support.html">CrossWalk - Cordova Plugin Support</a></p>

<h3>WKWebView JSBridge 事件传递</h3>

<p>在 WKWebView 中，开始原生支持 web 向 Native 发送消息，是通过 messageHandler 实现的。</p>

<p>在 UIWebView 时代，实现 web 向 app 发送消息，通常是通过 iframe 发起一个特殊请求，UIWebView 通过在拦截方法中，拦截这个特殊请求，使用这种类似 hack 的方式曲线救国的。</p>

<h4>实现步骤</h4>

<ul>
<li>Native 端添加 messageHandler</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='objectivec'><span class='line'><span class="n">WKUserContentController</span><span class="o">*</span> <span class="n">userContentController</span> <span class="o">=</span> <span class="p">[[</span><span class="n">WKUserContentController</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'><span class="c1">// 关键代码，添加 messageHandler，名字为 cordova</span>
</span><span class='line'><span class="p">[</span><span class="n">userContentController</span> <span class="nl">addScriptMessageHandler</span><span class="p">:</span><span class="nb">self</span> <span class="nl">name</span><span class="p">:</span><span class="s">@&quot;cordova&quot;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="n">WKWebViewConfiguration</span><span class="o">*</span> <span class="n">configuration</span> <span class="o">=</span> <span class="p">[[</span><span class="n">WKWebViewConfiguration</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'><span class="n">configuration</span><span class="p">.</span><span class="n">userContentController</span> <span class="o">=</span> <span class="n">userContentController</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">WKWebView</span><span class="o">*</span> <span class="n">wkWebView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">WKWebView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">frame</span> <span class="nl">configuration</span><span class="p">:</span><span class="n">configuration</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>JS 端调用</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//调用名为 cordova 的 messageHandler，与 Native 端进行通信</span>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">webkit</span><span class="p">.</span><span class="nx">messageHandlers</span><span class="p">.</span><span class="nx">cordova</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">command</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Native 接收</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objectivec'><span class='line'><span class="c1">//实现 WKScriptMessageHandler 接口</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">userContentController:</span><span class="p">(</span><span class="n">WKUserContentController</span><span class="o">*</span><span class="p">)</span><span class="nv">userContentController</span> <span class="nf">didReceiveScriptMessage:</span><span class="p">(</span><span class="n">WKScriptMessage</span><span class="o">*</span><span class="p">)</span><span class="nv">message</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@&quot;</span><span class="p">,</span><span class="n">message</span><span class="p">.</span><span class="n">name</span><span class="p">);</span> <span class="c1">//cordova</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@&quot;</span><span class="p">,</span><span class="n">message</span><span class="p">.</span><span class="n">body</span><span class="p">);</span> <span class="c1">//JSBridge 内容体</span>
</span><span class='line'>    <span class="p">...</span> <span class="c1">//实现调用 Native 代码</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>一个 messageHandler 一个通道，Cordova 统一使用 cordova 这个通道来通信。</p>

<h3>新增一个插件的实现步骤</h3>

<p>目录结构（列出关键目录与文件）：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='objectivec'><span class='line'><span class="o">|</span><span class="n">wkwvtest</span>
</span><span class='line'>    <span class="o">|</span><span class="n">Staging</span>
</span><span class='line'>        <span class="n">config</span><span class="p">.</span><span class="n">xml</span>
</span><span class='line'>        <span class="o">|</span><span class="n">www</span>
</span><span class='line'>            <span class="n">cordova_plugins</span><span class="p">.</span><span class="n">js</span>
</span><span class='line'>            <span class="o">|</span><span class="n">plugins</span> <span class="c1">//JS Plugihns</span>
</span><span class='line'>    <span class="o">|</span><span class="n">Plugins</span> <span class="c1">// Native Plugins</span>
</span></code></pre></td></tr></table></div></figure>


<p>已实现一个 Device 插件为例：</p>

<ul>
<li>在 Staging/www/plugins 目录下，新增一个 device.js 文件，添加 JS 代码</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">cordova</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;org.apache.cordova.device.device&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span> <span class="nx">exports</span><span class="p">,</span> <span class="nx">module</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">function</span> <span class="nx">Device</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="c1">//...</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="c1">//...</span>
</span><span class='line'>    <span class="nx">Device</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getInfo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">successCallback</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="c1">//调用 JSBridge，调用名为 Device 的 Native 类 getDeviceInfo 方法</span>
</span><span class='line'>        <span class="nx">exec</span><span class="p">(</span><span class="nx">successCallback</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">,</span> <span class="s2">&quot;Device&quot;</span><span class="p">,</span> <span class="s2">&quot;getDeviceInfo&quot;</span><span class="p">,</span> <span class="p">[]);</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Device</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>在 Staging/www/cordova_plugins.js 文件中注册 device.js</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">cordova</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;cordova/plugin_list&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span> <span class="nx">exports</span><span class="p">,</span> <span class="nx">module</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">[</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="s2">&quot;file&quot;</span><span class="o">:</span> <span class="s2">&quot;plugins/device.js&quot;</span><span class="p">,</span><span class="c1">//写明相对 cordova_plugins.js 的文件路径</span>
</span><span class='line'>            <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;org.apache.cordova.device.device&quot;</span><span class="p">,</span>
</span><span class='line'>            <span class="s2">&quot;clobbers&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>                 <span class="s2">&quot;device&quot;</span> <span class="c1">//全局命名空间，会注册为 window.device</span>
</span><span class='line'>            <span class="p">]</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">];</span>
</span><span class='line'>    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">metadata</span> <span class="o">=</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="s2">&quot;org.apache.cordova.device&quot;</span><span class="o">:</span> <span class="s2">&quot;0.3.0&quot;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>添加在 plugins 目录下，新增 CDVDevice 类，继承于 CDVPlugin</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objectivec'><span class='line'><span class="k">@interface</span> <span class="nc">CDVDevice</span> : <span class="nc">CDVPlugin</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">getDeviceInfo:</span><span class="p">(</span><span class="n">CDVInvokedUrlCommand</span><span class="o">*</span><span class="p">)</span><span class="nv">command</span><span class="p">;</span>
</span><span class='line'><span class="k">@end</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>在 Staging/config.xml 中注册 CDVDevice</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;widget</span> <span class="na">id=</span><span class="s">&quot;my.project.wkwvtest&quot;</span> <span class="na">version=</span><span class="s">&quot;0.0.1&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.w3.org/ns/widgets&quot;</span> <span class="na">xmlns:cdv=</span><span class="s">&quot;http://cordova.apache.org/ns/1.0&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;feature</span> <span class="na">name=</span><span class="s">&quot;Device&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;param</span> <span class="na">name=</span><span class="s">&quot;ios-package&quot;</span> <span class="na">value=</span><span class="s">&quot;CDVDevice&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/feature&gt;</span>
</span><span class='line'><span class="nt">&lt;/widget&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>完成这步骤，便可以通过 web 端，调用 <code>exec(successCallback, errorCallback, "Device", "getDeviceInfo", []);</code>，调用 Device 这个 Native 类的 getDeviceInfo 方法</p>

<p>详见：<a href="https://github.com/sjpsega/CordovaWKWebViewTest">CordovaWKWebViewTest</a></p>

<h3>&ldquo;同步&rdquo; JSBridge 代码执行</h3>

<p>这里的"同步"需要打引号，虽然 WKWebView 提供了原生 web 向 Native 发送消息的方案，但是注意，这里是发送消息，还不是同步回调。</p>

<p>Cordova 新版本的插件机制，通过多重事件机制的方式，使得一种类型的 JSBridge 同步成为可能 - webView 打开页面后，需要调用 Native 端获取环境变量的 JSBridge。比如上例的 Device 这个 JSBridge 就是典型。</p>

<p>Cordova 启动的几个重要事件：</p>

<ul>
<li>onNativeReady</li>
<li>onDOMContentLoaded</li>
<li>onPluginsReady</li>
<li>onCordovaReady</li>
<li>onDeviceReady</li>
</ul>


<p>通常是从上往下依次进行，并且 web 开始调用 JSBridge，必须监听 <code>deviceready</code> 事件，所以 onDeviceReady 始终最后执行，代表 Cordova 插件环境完全准备完毕。</p>

<p>所以，这种"同步" JSBridge 就是利用这个特性，做了一些文章。</p>

<p>看关键代码：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">cordova</span><span class="p">.</span><span class="nx">define</span><span class="p">(</span><span class="s2">&quot;org.apache.cordova.device.device&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span> <span class="nx">exports</span><span class="p">,</span> <span class="nx">module</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">channel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cordova/channel&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="nx">exec</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cordova/exec&#39;</span><span class="p">),</span>
</span><span class='line'>    <span class="c1">//注册名为 onCordovaInfoReady 的 Sticky 类型的事件</span>
</span><span class='line'>    <span class="nx">channel</span><span class="p">.</span><span class="nx">createSticky</span><span class="p">(</span><span class="s1">&#39;onCordovaInfoReady&#39;</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//告诉系统，必须等待 CordovaInfoReady 事件发送</span>
</span><span class='line'>    <span class="nx">channel</span><span class="p">.</span><span class="nx">waitForInitialization</span><span class="p">(</span><span class="s1">&#39;onCordovaInfoReady&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">function</span> <span class="nx">Device</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">me</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>        <span class="c1">//在 onCordovaReady 事件中，注册回调，使得系统初始化便调用该回调，并且 onCordovaReady 在 onPluginsReady 事件后 fire</span>
</span><span class='line'>        <span class="nx">channel</span><span class="p">.</span><span class="nx">onCordovaReady</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>            <span class="c1">//调用 JSBridge</span>
</span><span class='line'>            <span class="nx">me</span><span class="p">.</span><span class="nx">getInfo</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">info</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="c1">//调用 JSBridge 成功回调用，fire onCordovaInfoReady 事件</span>
</span><span class='line'>                <span class="nx">channel</span><span class="p">.</span><span class="nx">onCordovaInfoReady</span><span class="p">.</span><span class="nx">fire</span><span class="p">();</span>
</span><span class='line'>            <span class="p">},</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="p">});</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">Device</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getInfo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">successCallback</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">exec</span><span class="p">(</span><span class="nx">successCallback</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">,</span> <span class="s2">&quot;Device&quot;</span><span class="p">,</span> <span class="s2">&quot;getDeviceInfo&quot;</span><span class="p">,</span> <span class="p">[]);</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Device</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>web 端调用 Device 的代码：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&quot;deviceready&quot;</span><span class="p">,</span> <span class="nx">onDeviceReady</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'><span class="kd">function</span> <span class="nx">onDeviceReady</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">device</span><span class="p">.</span><span class="nx">uuid</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>可以看到，deviceready 的时候，便可以直接调用 device 这个全局变量。
这是因为之前在 cordova_plugins.js 这个文件中，做了申明，会把 device 变为全局变量</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="s2">&quot;clobbers&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="s2">&quot;device&quot;</span> <span class="c1">//全局命名空间，会注册为 window.device</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>这种设计非常巧妙，但是以我的经验，这种形式的 JSBridge 使用比较局限，主要缺点有：</p>

<ul>
<li>只能对整个 App 周期，固定不变的值使用。如果使用中，这个值会变化则无法使用，如地理位置信息就不行</li>
<li>只能针对属性使用，不能对方法使用</li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2019/11/23/crazyusstock/">疯狂的美股</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/09/15/910/">怒放的生命</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/07/22/kechuangban/">科创板</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/04/04/payout/">用错误的方法赚到钱，迟早要还</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/01/01/2018summary/">2018 年终总结</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>About Me</h1>
  <p>程序员</p>
  <p>技术经历：As -> Js -> iOS</p>
  <p>新浪微博：<a href="http://weibo.com/sjpsega">IORI_YAGAMI_7</a></p>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - sjpsega -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  









<!--cnzz统计-->
<script src="http://s13.cnzz.com/stat.php?id=5808684&web_id=5808684" language="JavaScript"></script>

</body>
</html>
